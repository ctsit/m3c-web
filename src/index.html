<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title>M3C People Portal</title>

    <!-- Font Awesome for neat icons. -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
        integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

    <!-- Roboto font -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="m3c.css" />

    <!-- Promise polyfill to support Internet Explorer -->
    <script crossorigin src="https://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.min.js"></script>
    <!-- Fetch polyfill to support Internet Explorer -->
    <script crossorigin src="https://unpkg.com/whatwg-fetch@3.0.0/dist/fetch.umd.js"></script>
    <!-- URL polyfill to support Internet Explorer -->
    <script crossorigin src="https://unpkg.com/@ungap/url-search-params@0.1.2/min.js"></script>

    <!-- animate.css licensed under the MIT License -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">

    <style>
        header {
            padding-bottom: 1em;
        }

        #links {
            display: table;
            text-align: center;
            width: 100%;
        }

        #links li {
            min-width: 9em;
            display: inline-block;
            padding: 2em 1em;
            text-align: center;
            background: white;
            margin: 1em 0.3em;
            border-radius: 50%;
        }

        #links li,
        #pub-widget,
        #study-widget {
            box-shadow: 3px 4px 5px gray;
        }

        .count {
            font-size: smaller;
            display: block;
        }

        .hero {
            width: 100%;
            padding: 1em;
            min-height: 2.5em;
            text-align: center;
            background: rgba(0, 169, 224, 0.4);
        }

        .hero-item:nth-child(n+2) {
            display: none;
        }

        .hero-item,
        .hero-item:visited {
            box-shadow: 3px 4px 5px rgba(0, 169, 224, 0.9);
            background: white;
            padding: 2em;
            margin: auto;
        }

        .hero-item {
            width: 100%;
            max-width: 1200px;
            display: flex;
            display: grid;
            grid-template-columns: 1fr 4fr 10fr 1fr;
        }

        .hero-item a.photo-frame {
            padding-right: 1em;
        }

        .hero-item img.photo {
            border-radius: 50%;
            border: 5px solid white;
            box-shadow: 0 0 3px gray;
            max-width: 300px;
            height: 200px;
        }

        .hero-item p {
            align-self: center;
            text-align: justify;
        }

        .hero-item .animated {
            background-color: white;
        }

        .animated {
            animation-duration: 500ms;
        }

        .visuals {
            margin: auto;
            margin-top: 1em;
            display: -ms-grid;
            display: grid;
            -ms-grid-columns: 1fr 0.1fr 1fr;
            /* grid-template-columns: repeat(auto-fit, 320px); */
            grid-template-columns: 1fr 1fr;
            grid-gap: 1em;
            width: 95%;
            justify-content: center;
            justify-items: stretch;
            padding-bottom: 1em;
        }

        .visuals div {
            background: white;
            padding: 1em;
            text-align: center;
        }

        .visuals a {
            display: block;
        }

        .visuals #pub-widget  { -ms-grid-column: 1 }
        .visuals #study-widget { -ms-grid-column: 3 }

        h3 {
            text-shadow: 1px 1px 3px gray;
            font-weight: 300;
            margin: 0.5em auto;
        }

        /* Slider */
        .spotlight {
            display: block;
            font-size: larger;
            text-shadow: 1px 1px 3px gray;
            font-weight: 300;
            margin-top: -1em;
            margin-bottom: 1em;
        }

        .spotlight i.fas {
            font-size: smaller;
        }

        a.prev-link,
        a.next-link {
            height: 100%;
            width: 100%;
            color:rgba(0, 169, 224, 0.4);
        }

        a.prev-link:hover,
        a.next-link:hover {
            color:rgba(0, 169, 224, 0.9);
        }

        div.prev,
        div.next {
            display: table;
            height: 100%;
            width: 100%;
        }

        div.prev i,
        div.next i {
            display: table-cell;
            vertical-align: middle;
            font-size: xx-large;
        }

        div.prev i { text-align: left; }
        div.next i { text-align: right; }
        /* End Slider */

        @media only screen and (max-width: 800px) {
            .hero {
                padding: 1% 0;
            }

            .hero-item {
                grid-template-columns: unset;
                width: 98%;
            }

            a.next-link,
            a.prev-link {
                display: none;
            }

            .animated {
                animation: unset;
            }

            .hero-item:nth-child(n+2) {
                display: flex;
                display: grid;
            }

            .hero-item a {
                justify-self: center;
                padding-right: 0;
            }

            .hero-item p {
                text-align: left;
                padding: 0;
            }

            .hero-item a.photo-frame {
                padding-right: 0;
            }

            .spotlight {
                text-align: center;
                margin-top: 0;
            }

            .visuals {
                margin: auto;
                margin-top: 1em;
                display: block;
                width: 100%;
                padding-bottom: 1em;
            }

            .visuals div {
                text-align: left;
            }

        }
    </style>

</head>

<body class="dashboard">

    <div class="container">

        <header>
            <a href="https://metabolomics.info/">
                <img alt="Metabolomics Info logo"
                    src="https://i2.wp.com/metabolomics.info/wp-content/uploads/2018/10/sepcc-logo-75.png?fit=60%2C60&ssl=1"
                    width=60 height=60>
                <div class="text">
                    <h1>Metabolomics Info</h1>
                    <p>Facilitating science through community</p>
                </div>
            </a>
            <div class="spacer"></div>
            <a id="menuToggle" aria-label="Toggle site navigation links">
                <i class="fas fa-fw fa-bars" aria-hidden="true"></i>
                <i class="fas fa-fw fa-times" aria-hidden="true"></i>
            </a>
            <nav>
                <a href="#content" class="sr-only">Skip to Content</a>
                <a href="index.html" class="dashboard-link current">
                    <h2>People Portal</h2>
                </a>
                <a href="https://metabolomics.info/about/">
                    <h2>About</h2>
                </a>
                <a href="https://metabolomics.info/events/">
                    <h2>Events</h2>
                </a>
                <a href="https://metabolomics.info/contact/">
                    <h2>Contact</h2>
                </a>
                <a href="https://metabolomics.info/consortium/">
                    <h2>NIH Consortium</h2>
                </a>
            </nav>
        </header>

        <div class="page">
            <nav>
                <ul id="links">
                    <li class="People">
                        <a href="people.html">
                            People
                            <div class="fas fa-spinner fa-spin"></div>
                            <span class="count"></span>
                        </a>
                    </li>
                    <li class="Publications">
                        <a href="publications.html">
                            Publications
                            <span class="count"></span>
                        </a>
                    </li>
                    <li class="Projects">
                        <a href="projects.html">
                            Projects
                            <span class="count"></span>
                        </a>
                    </li>
                    <li class="Studies">
                        <a href="studies.html">
                            Studies
                            <span class="count"></span>
                        </a>
                    </li>
                    <li class="Organizations">
                        <a href="organizations.html">
                            Organizations
                            <span class="count"></span>
                        </a>
                    </li>
                    <li class="Tools">
                        <a href="tools.html">
                            Tools
                            <span class="count"></span>
                        </a>
                    </li>
                </ul>
            </nav>

            <div id="content" class="hero">
                <div class="hero-item person">
                    <a class="prev-link" tabindex="0">
                        <div class="prev">
                            <i class="fas fa-arrow-left"></i>
                        </div>
                    </a>

                    <a class="photo-frame person" href="person.html?iri=https://vivo.metabolomics.info/individual/p6">
                        <img class="photo" alt="Oliver Fiehn" src="https://people.metabolomics.info/file/n1159/FiehnOliver373.jpg" />
                        <div class="name">Oliver Fiehn</div>
                    </a>

                    <div class="about">
                        <span class="spotlight"><i class="fas fa-user"></i> Person Spotlight</span>
                        <p>
                        <strong>Oliver Fiehn</strong> is an analytical chemist. He received his MSc degree
                        in Analytical Sciences in 1993 from Free University Berlin and received his PhD in 1997 at
                        Technical University of Berlin in Analytical Chemistry, having performed graduate research with
                        the Max-Planck Institute for Molecular Plant Physiology in Potsdam.
                        </p>
                        <p>
                        He is a Professor and Director of West Coast Metabolomics Center (WCMC) at the University of California, Davis.
                        The WCMC is a major aspect of the work in the NIH Metabolomics Consortium whose goal is to develop processes
                        and resources that accelerate and improve the accuracy of the compound identification workflow for experts
                        and medical professionals.
                        </p>
                    </div>

                    <a class="next-link" tabindex="0">
                        <div class="next">
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </a>
                </div>

                <div class="hero-item study">
                    <a class="prev-link" tabindex="0">
                        <div class="prev">
                            <i class="fas fa-arrow-left"></i>
                        </div>
                    </a>

                    <a class="photo-frame person" href="person.html?iri=https://vivo.metabolomics.info/individual/p1459" >
                        <img class="photo" alt="Jeremy Whitson" src="https://people.metabolomics.info/file/p1459pic/photo.jpg" />
                        <div class="name">Jeremy Whitson</div>
                    </a>

                    <div class="about">
                        <span class="spotlight"><i class="fas fa-chart-line"></i> Study Spotlight</span>
                        <p>
                            <a href="study.html?iri=https://vivo.metabolomics.info/individual/ST001329" class="study">
                                <strong>SS-31 and NMN: Two Paths to Improve Metabolism and Function in Aged Hearts</strong>
                            </a>
                        </p><p>
                            The effects of two different mitochondrial-targeted drugs, SS-31 and NMN, were tested on Old mouse hearts. After treatment with the drugs, individually or Combined, heart function was examined by echocardiography. SS-31 partially reversed an age-related decline in diastolic function while NMN fully reversed an age-related deficiency in systolic function at a higher workload. Metabolomic analysis revealed that both NMN and the Combined treatment increased nicotinamide and 1-methylnicotinamide levels, indicating greater NAD+ turnover, but only the Combined treatment resulted in significantly greater steady state NAD(H) levels.
                        </p>
                    </div>

                    <a class="next-link" tabindex="0">
                        <div class="next">
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </a>
                </div>

                <div class="hero-item project">
                    <a class="prev-link" tabindex="0">
                        <div class="prev">
                            <i class="fas fa-arrow-left"></i>
                        </div>
                    </a>

                    <a class="photo-frame person" href="person.html?iri=https://vivo.metabolomics.info/individual/p1495">
                        <img class="photo" alt="Cátia Pacífico" src="https://vivo.metabolomics.info/file/n2577/Catia_Pacifico.jpg" />
                        <div class="name">Cátia Pacífico</div>
                    </a>

                    <div class="about">
                        <span class="spotlight"><i class="fas fa-project-diagram"></i> Project Spotlight</span>
                        <p>
                            <a href="project.html?iri=https://vivo.metabolomics.info/individual/PR000919" class="project">
                                <strong>Serum Metabolome of Simmental Dairy Cows Switched to High-Grain Diet during Early Lactation</strong>
                            </a>
                        </p><p>
                            In dairy cows, early lactation is associated with an energy deficit that is counteracted by increasing the amounts of grains in the diet. Yet, such diet often increases the odds for cows to develop digestive and systemic metabolic derailments, which can likely be detected as undesirable shifts in the serum metabolome. The present study aimed to identify the metabolic signatures of the serum metabolome of early lactation dairy cows fed high-grain diet.
                        </p>
                    </div>

                    <a class="next-link" tabindex="0">
                        <div class="next">
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </a>
                </div>

            </div>

            <div class="visuals">
                <!-- Widgets for Latest Publications and Latest Studies -->
                    <div id="pub-widget" class="Publications">
                        <a href="publications.html">
                            <h3>Latest Publications</h3>
                        </a>
                        <ol class="list-widget pub-results">
                                <li class="publication template">
                                    <div>
                                        <a href="#" class="name link"
                                            target="_blank" rel="noopener noreferrer"></a>
                                        <span class="year"></span>
                                        <span class="authors"></span>
                                    </div>
                                </li>
                        </ol>
                    </div>
                    <div id="study-widget" class="Studies">
                        <a href="studies.html">
                                <h3>Latest Studies</h3>
                        </a>
                        <ol class="list-widget study-results">
                            <li class="study template">
                                <div>
                                        <a href="https://www.metabolomicsworkbench.org/data/DRCCMetadata.php?Mode=Study" class="name link"
                                            target="_blank" rel="noopener noreferrer"></a>
                                        <span class="submitted"></span>
                                        <span class="institute"></span>
                                    </div>
                                </li>
                        </ol>
                    </div>
                </div>

        </div> <!-- div.page -->

        <footer>
            <p>
                Metabolomics Info is an outreach portal to support the
                Metabolomics community.
            </p>
            <p>
                © 2020 Metabolomics&nbsp;Consortium Coordinating&nbsp;Center
            </p>
        </footer>

        <!-- The order is important. -->
        <script src="tpf.js"></script>
        <script src="str.js"></script>
        <script src="m3c.js"></script>
        <script src="ui.js"></script>
        <script src="entity.js"></script>

        <script>
            const client = m3c.NewTPFClient()
            const links = document.getElementById("links")
            const items = links.querySelectorAll("li")
            for (var i = 0; i < items.length; i++) {
                addLink(items[i])
            }

            const personLinks = document.querySelectorAll("a.person")
            for (var i = 0; i < personLinks.length; i++) {
                updateProfileLink("person", personLinks[i])
            }

            const studyLinks = document.querySelectorAll("a.study")
            for (var i = 0; i < studyLinks.length; i++) {
                updateProfileLink("study", studyLinks[i])
            }

            const projectLinks = document.querySelectorAll("a.project")
            for (var i = 0; i < projectLinks.length; i++) {
                updateProfileLink("project", projectLinks[i])
            }

            var lastSlide = new Date()
            const sliderTimer = setInterval(slide, 1000) // Check every second

            const nextLinks = document.querySelectorAll("a.next-link")
            for (var i = 0; i < nextLinks.length; i++) {
                addNextLinkClickHandler(nextLinks[i])
            }

            const prevLinks = document.querySelectorAll("a.prev-link")
            for (var i = 0; i < prevLinks.length; i++) {
                addPrevLinkClickHandler(prevLinks[i])
            }

            const widgetLinks = document.querySelector(".visuals")
            const widgetPub = widgetLinks.querySelector("#pub-widget")
            addWidgetLink(widgetPub)
            const widgetStudy = widgetLinks.querySelector("#study-widget")
            addWidgetLink(widgetStudy)

            function addLink(li) {
                const concept = li.className
                const lowered = concept.toLowerCase()
                const type = m3c.IRIFor(concept)

                m3c.Count(client, type, renderCount)

                function renderCount(count) {
                    li.querySelector("a").href = m3c.ListingLink(lowered)
                    li.querySelector(".count").innerText = count
                }
            }

            function addNextLinkClickHandler(link) {
                link.addEventListener("click", onNextClick)
                link.slideNext = onNextClick

                function onNextClick(clickEvent) {
                    if (clickEvent) {
                        clickEvent.preventDefault()
                        // Clicking the navigation arrows effectively stops the
                        clearInterval(sliderTimer)
                    }

                    const item = link.parentElement
                    const slider = item.parentElement
                    const next = item.nextElementSibling

                    item.addEventListener("animationend", afterAnimation)
                    item.className = item.className.replace(/(animated|slide(In|Out)(Left|Right))/g, "")
                    item.className = (item.className + " animated slideOutLeft").trim()

                    lastSlide = new Date()
                    function afterAnimation() {
                        item.removeEventListener("animationend", afterAnimation)
                        next.className = next.className.replace(/(animated|slide(In|Out)(Left|Right))/g, "")
                        next.className = (next.className + " animated slideInRight").trim()
                        slider.appendChild(item)
                        lastSlide = new Date()
                    }
                }
            }

            function addPrevLinkClickHandler(link) {
                link.addEventListener("click", onPrevClick)

                function onPrevClick(clickEvent) {
                    if (clickEvent) {
                        clickEvent.preventDefault()
                        // Clicking the navigation arrows effectively stops the
                        clearInterval(sliderTimer)
                    }

                    const item = link.parentElement
                    const slider = item.parentElement
                    const prev = slider.lastElementChild

                    item.addEventListener("animationend", afterAnimation)
                    item.className = item.className.replace(/(animated|slide(In|Out)(Left|Right))/g, "")
                    item.className = (item.className + " animated slideOutRight").trim()

                    lastSlide = new Date()
                    function afterAnimation() {
                        item.removeEventListener("animationend", afterAnimation)
                        prev.className = prev.className.replace(/(animated|slide(In|Out)(Left|Right))/g, "")
                        prev.className = (prev.className + " animated slideInLeft").trim()

                        slider.insertBefore(prev, item)
                        lastSlide = new Date()
                    }
                }
            }

            function slide() {
                const maxDurationSecs = 10
                // Check to see if it has been 10 seconds since the last slide.
                // If it has, then slide again.
                const cutoff = new Date()
                cutoff.setSeconds(cutoff.getSeconds() - maxDurationSecs)

                if (lastSlide < cutoff) {
                    document.querySelector("a.next-link").slideNext()
                }
            }

            function updateProfileLink(concept, link) {
                const fragment = concept + ".html?iri="
                const start = link.href.indexOf(fragment)
                const iri = link.href.slice(start + fragment.length)

                link.href = m3c.ProfileLink(concept, iri)
                if (concept !== "person") {
                    return
                }

                const person = entity.Person(client, iri)
                person.Photo(function (url) {
                    link.querySelector("img.photo").src =
                        m3c.PhotoURL(client.Endpoint, url)
                })
            }
            function addWidgetLink(id) {
                const concept = id.className
                const lowered = concept.toLowerCase()

                id.querySelector("a").href = m3c.ListingLink(lowered)
            }

            // script for the Publication and Studies list dashboard widgets

            // Aliases for certain HTML elements
            const pubRoot = document.getElementById("pub-widget")
            const studyRoot = document.getElementById("study-widget")
            const studyResults = studyRoot.querySelector(".study-results")
            const publicationTemplate = pubRoot.querySelector("li.publication.template")
            const studyTemplate = studyRoot.querySelector("li.study.template")

            // Query the TPF server for all studies and some related data.
            const studyData = {
                studies: [],
                names: {},
                submitted: {},
            }

            const promises = [
                entity.Names(client),
                entity.Studies(client),
                entity.SubmissionDates(client),
            ]

            // Read the Publications from a local .json file
            fetch("publicationlist.json")
                .then(function (res) {
                    return res.json()
                })
                .then(function (pubs) {
                    pubs.forEach(renderPublication)
                })

            Promise.all(promises)
                .then(function setData(studyResults) {
                    studyData.names = studyResults[0]
                    studyData.studies = studyResults[1]
                    studyData.submitted = studyResults[2]

                    studyData.studies.sort(function (a, b) {
                        const aSubmitted = studyData.submitted[a]
                        const bSubmitted = studyData.submitted[b]
                        return bSubmitted - aSubmitted
                    })

                    // Show only the most recent 10 studies.
                    studyData.studies.slice(0,10).forEach(renderStudy)
                })

            /**
             * Render a publication.
             *
             * @param {{
             *   iri: string,
             *   pmid: string,
             *   title: string,
             *   authors: string[],
             *   published: string,
             * }} publication
             */
            function renderPublication(publication) {
                var authors = publication.authors
                authors.filter(function (name) {
                    // Filter out nameless authors. This can happen with
                    // withheld records.
                    return !!name
                })

                authors.sort(function (a, b) {
                    const aname = sortLastFirst(a)
                    const bname = sortLastFirst(b)
                    if (aname < bname) {
                        return -1
                    }

                    if (aname > bname) {
                        return +1
                    }

                    return 0
                })

                const uri = publication.iri.slice(1, -1)

                const bindings = {
                    link: {
                        href: m3c.ProfileLink("publication", uri),
                    },
                    name: publication.title,
                    year: publication.published ? publication.published : "",
                    authors: authors ? authors.join(", ") : "",
                }

                const li = ui.Render(publicationTemplate, bindings)
            }

            /**
             * Render a study with the specified IRI.
             * @param {string} studyIRI
             */
            function renderStudy(studyIRI) {
                const uri = studyIRI.slice(1, -1)
                /** @type {Date} */
                const submitted = studyData.submitted[studyIRI]
                const study = entity.Study(client, uri)

                const bindings = {
                    link: {
                        href: m3c.ProfileLink("study", uri),
                    },
                    name: entity.ParseVIVOString(studyData.names[studyIRI]),
                    submitted: submitted ? submitted.toLocaleDateString() : null,
                    institute: getInstitute,
                }

                const li = ui.Render(studyTemplate, bindings)

                function getInstitute(callback) {
                    return new Promise(function (resolve) {
                        return study.Institute(resolve)
                    }).then(function (instituteIRI) {
                        const institute = studyData.names[instituteIRI]
                        callback(institute)
                    })
                }
            }

            /**
             * @param {string} name
             */
            function sortLastFirst(name) {
                const firstLast = name.toUpperCase()
                const lastFirst = firstLast.split(' ').reverse().join(' ')
                return lastFirst
            }
        </script>

    </div> <!-- div.container -->
</body>

</html>
